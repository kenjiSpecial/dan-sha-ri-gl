!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.dsr={})}(this,function(t){"use strict";var e=5126;function r(t){for(var e=t.split("\n"),r=0;r<e.length;r++)e[r]=r+1+": "+e[r];return e.join("\n")}function n(t,e,n){var o=t.createShader(e);return t.shaderSource(o,n),t.compileShader(o),t.getShaderParameter(o,t.COMPILE_STATUS)?o:(console.error("[WebGLShader]: Shader couldn't compile."),""!==t.getShaderInfoLog(o)?(console.warn("[WebGLShader]: gl.getShaderInfoLog()",e===t.VERTEX_SHADER?"vertex":"fragment",t.getShaderInfoLog(o),r(n)),null):void 0)}var o=1e-6,i="undefined"!=typeof Float32Array?Float32Array:Array,a=Math.random,u=Object.freeze({EPSILON:o,ARRAY_TYPE:i,RANDOM:a});function c(){var t=new i(16);return i!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function f(t,e,r,n,o){var i=1/Math.tan(e/2),a=void 0;return t[0]=i/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=o&&o!==1/0?(a=1/(n-o),t[10]=(o+n)*a,t[14]=2*o*n*a):(t[10]=-1,t[14]=-2*n),t}function s(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function h(t,e,r,n){var i=void 0,a=void 0,u=void 0,c=void 0,f=void 0,h=void 0,v=void 0,l=void 0,d=void 0,g=void 0,M=e[0],p=e[1],A=e[2],m=n[0],y=n[1],x=n[2],b=r[0],R=r[1],P=r[2];return Math.abs(M-b)<o&&Math.abs(p-R)<o&&Math.abs(A-P)<o?s(t):(v=M-b,l=p-R,d=A-P,i=y*(d*=g=1/Math.sqrt(v*v+l*l+d*d))-x*(l*=g),a=x*(v*=g)-m*d,u=m*l-y*v,(g=Math.sqrt(i*i+a*a+u*u))?(i*=g=1/g,a*=g,u*=g):(i=0,a=0,u=0),c=l*u-d*a,f=d*i-v*u,h=v*a-l*i,(g=Math.sqrt(c*c+f*f+h*h))?(c*=g=1/g,f*=g,h*=g):(c=0,f=0,h=0),t[0]=i,t[1]=c,t[2]=v,t[3]=0,t[4]=a,t[5]=f,t[6]=l,t[7]=0,t[8]=u,t[9]=h,t[10]=d,t[11]=0,t[12]=-(i*M+a*p+u*A),t[13]=-(c*M+f*p+h*A),t[14]=-(v*M+l*p+d*A),t[15]=1,t)}var v=Object.freeze({create:c,multiply:function(t,e,r){var n=e[0],o=e[1],i=e[2],a=e[3],u=e[4],c=e[5],f=e[6],s=e[7],h=e[8],v=e[9],l=e[10],d=e[11],g=e[12],M=e[13],p=e[14],A=e[15],m=r[0],y=r[1],x=r[2],b=r[3];return t[0]=m*n+y*u+x*h+b*g,t[1]=m*o+y*c+x*v+b*M,t[2]=m*i+y*f+x*l+b*p,t[3]=m*a+y*s+x*d+b*A,m=r[4],y=r[5],x=r[6],b=r[7],t[4]=m*n+y*u+x*h+b*g,t[5]=m*o+y*c+x*v+b*M,t[6]=m*i+y*f+x*l+b*p,t[7]=m*a+y*s+x*d+b*A,m=r[8],y=r[9],x=r[10],b=r[11],t[8]=m*n+y*u+x*h+b*g,t[9]=m*o+y*c+x*v+b*M,t[10]=m*i+y*f+x*l+b*p,t[11]=m*a+y*s+x*d+b*A,m=r[12],y=r[13],x=r[14],b=r[15],t[12]=m*n+y*u+x*h+b*g,t[13]=m*o+y*c+x*v+b*M,t[14]=m*i+y*f+x*l+b*p,t[15]=m*a+y*s+x*d+b*A,t},perspective:f,identity:s,clone:function(t){for(var e=new i(16),r=0;r<e.length;r++)e[r]=t[r];return e},fromTranslation:function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},fromYRotation:function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},lookAt:h,fromRotationTranslationScale:function(t,e,r,n){var o=e[0],i=e[1],a=e[2],u=e[3],c=o+o,f=i+i,s=a+a,h=o*c,v=o*f,l=o*s,d=i*f,g=i*s,M=a*s,p=u*c,A=u*f,m=u*s,y=n[0],x=n[1],b=n[2];return t[0]=(1-(d+M))*y,t[1]=(v+m)*y,t[2]=(l-A)*y,t[3]=0,t[4]=(v-m)*x,t[5]=(1-(h+M))*x,t[6]=(g+p)*x,t[7]=0,t[8]=(l+A)*b,t[9]=(g-p)*b,t[10]=(1-(h+d))*b,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},fromXRotation:function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},targetTo:function(t,e,r,n){var o=e[0],i=e[1],a=e[2],u=n[0],c=n[1],f=n[2],s=o-r[0],h=i-r[1],v=a-r[2],l=s*s+h*h+v*v;l>0&&(s*=l=1/Math.sqrt(l),h*=l,v*=l);var d=c*v-f*h,g=f*s-u*v,M=u*h-c*s;return(l=d*d+g*g+M*M)>0&&(d*=l=1/Math.sqrt(l),g*=l,M*=l),t[0]=d,t[1]=g,t[2]=M,t[3]=0,t[4]=h*M-v*g,t[5]=v*d-s*M,t[6]=s*g-h*d,t[7]=0,t[8]=s,t[9]=h,t[10]=v,t[11]=0,t[12]=o,t[13]=i,t[14]=a,t[15]=1,t},transpose:function(t,e){if(t===e){var r=e[1],n=e[2],o=e[3],i=e[6],a=e[7],u=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=i,t[11]=e[14],t[12]=o,t[13]=a,t[14]=u}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},invert:function(t,e){var r=e[0],n=e[1],o=e[2],i=e[3],a=e[4],u=e[5],c=e[6],f=e[7],s=e[8],h=e[9],v=e[10],l=e[11],d=e[12],g=e[13],M=e[14],p=e[15],A=r*u-n*a,m=r*c-o*a,y=r*f-i*a,x=n*c-o*u,b=n*f-i*u,R=o*f-i*c,P=s*g-h*d,S=s*M-v*d,E=s*p-l*d,_=h*M-v*g,T=h*p-l*g,L=v*p-l*M,k=A*L-m*T+y*_+x*E-b*S+R*P;return k?(k=1/k,t[0]=(u*L-c*T+f*_)*k,t[1]=(o*T-n*L-i*_)*k,t[2]=(g*R-M*b+p*x)*k,t[3]=(v*b-h*R-l*x)*k,t[4]=(c*E-a*L-f*S)*k,t[5]=(r*L-o*E+i*S)*k,t[6]=(M*y-d*R-p*m)*k,t[7]=(s*R-v*y+l*m)*k,t[8]=(a*T-u*E+f*P)*k,t[9]=(n*E-r*T-i*P)*k,t[10]=(d*b-g*y+p*A)*k,t[11]=(h*y-s*b-l*A)*k,t[12]=(u*S-a*_-c*P)*k,t[13]=(r*_-n*S+o*P)*k,t[14]=(g*m-d*x-M*A)*k,t[15]=(s*x-h*m+v*A)*k,t):null}});var l=Object.freeze({create:function(){var t=new i(4);return i!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}});var d=Object.freeze({create:function(){var t=new i(3);return i!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t},add:function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t},rotateZ:function(t,e,r,n){var o=[],i=[];return o[0]=e[0]-r[0],o[1]=e[1]-r[1],o[2]=e[2]-r[2],i[0]=o[0]*Math.cos(n)-o[1]*Math.sin(n),i[1]=o[0]*Math.sin(n)+o[1]*Math.cos(n),i[2]=o[2],t[0]=i[0]+r[0],t[1]=i[1]+r[1],t[2]=i[2]+r[2],t},rotateY:function(t,e,r,n){var o=[],i=[];return o[0]=e[0]-r[0],o[1]=e[1]-r[1],o[2]=e[2]-r[2],i[0]=o[2]*Math.sin(n)+o[0]*Math.cos(n),i[1]=o[1],i[2]=o[2]*Math.cos(n)-o[0]*Math.sin(n),t[0]=i[0]+r[0],t[1]=i[1]+r[1],t[2]=i[2]+r[2],t},transformMat4:function(t,e,r){var n=e[0],o=e[1],i=e[2],a=r[3]*n+r[7]*o+r[11]*i+r[15];return a=a||1,t[0]=(r[0]*n+r[4]*o+r[8]*i+r[12])/a,t[1]=(r[1]*n+r[5]*o+r[9]*i+r[13])/a,t[2]=(r[2]*n+r[6]*o+r[10]*i+r[14])/a,t},normalize:function(t,e){var r=e[0],n=e[1],o=e[2],i=r*r+n*n+o*o;return i>0&&(i=1/Math.sqrt(i),t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i),t},cross:function(t,e,r){var n=e[0],o=e[1],i=e[2],a=r[0],u=r[1],c=r[2];return t[0]=o*c-i*u,t[1]=i*a-n*c,t[2]=n*u-o*a,t}});var g=Object.freeze({clamp:function(t,e,r){return Math.min(Math.max(t,e),r)},range:function(t,e){return(e-t)*Math.random()+t},calculateCircleCenter:function(t,e,r){var n={},o=(e.y-t.y)/(e.x-t.x),i=(r.y-e.y)/(r.x-e.x);return n.x=(o*i*(t.y-r.y)+i*(t.x+e.x)-o*(e.x+r.x))/(2*(i-o)),n.y=-1*(n.x-(t.x+e.x)/2)/o+(t.y+e.y)/2,n},mix:function(t,e,r){return t*(1-r)+e*r},degToRad:function(t){return.017453292519943295*t},radToDeg:function(t){return 57.29577951308232*t}}),M=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},p=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),A=function(){function t(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:45,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e3;M(this,t),this.position={x:0,y:0,z:0},this.lookAtPosition={x:0,y:0,z:0},this._viewMatrix=c(),this._projectionMatrix=c(),this.updatePerspective(e,r,n,o,i)}return p(t,[{key:"updatePerspective",value:function(t,e,r,n,o){f(this._projectionMatrix,r/180*Math.PI,t/e,n,o)}},{key:"updatePosition",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.position.x=t,this.position.y=e,this.position.z=r}},{key:"updateLookAtPosition",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-100;this.lookAtPosition.x=t,this.lookAtPosition.y=e,this.lookAtPosition.z=r}},{key:"updateViewMatrix",value:function(){h(this._viewMatrix,[this.position.x,this.position.y,this.position.z],[this.lookAtPosition.x,this.lookAtPosition.y,this.lookAtPosition.z],[0,1,0])}},{key:"viewMatrix",get:function(){return this._viewMatrix}},{key:"projectionMatrix",get:function(){return this._projectionMatrix}}]),t}();console.log("[danshariGL] version: 0.1.0, %o","https://github.com/kenjiSpecial/tubugl"),t.getUniformLocations=function(t,e,r){for(var n={},o=0;o<r.length;o++){var i=r[o],a=t.getUniformLocation(e,i);n[i]=a}return n},t.addLineNumbers=r,t.compileGLShader=n,t.createPrgoram=function(t,e,r){var o=t.createProgram(),i=n(t,t.VERTEX_SHADER,e),a=n(t,t.FRAGMENT_SHADER,r);t.attachShader(o,i),t.attachShader(o,a),t.linkProgram(o);try{if(!t.getProgramParameter(o,t.LINK_STATUS))throw t.getProgramInfoLog(o)}catch(t){console.error("WebGLProgram: "+t)}return o},t.creteBuffer=function(t,e,r,n){var o=t.createBuffer(),i=t.getAttribLocation(e,n);return t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),{buffer:o,location:i}},t.createIndex=function(t,e){var r=t.createBuffer();return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r),t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW),{cnt:e.length,buffer:r}},t.bindBuffer=function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;t.bindBuffer(t.ARRAY_BUFFER,r),t.vertexAttribPointer(n,o,i,a,u,c),t.enableVertexAttribArray(n)},t.getAjaxJson=function(t){return new Promise(function(e,r){var n=new XMLHttpRequest;n.open("GET",t,!0),n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status){var t=n.responseText,o=JSON.parse(t);e(o)}else r(n.status)},n.send()})},t.getImage=function(t){return new Promise(function(e,r){var n=new Image;n.onload=function(){e(n)},n.onerror=function(){r("image is not loaded")},n.src=t})},t.getSphere=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:64,n=[],o=[],i=[],a=[],u=0;u<=e;++u)for(var c=u*Math.PI/e,f=Math.sin(c),s=Math.cos(c),h=0;h<=r;++h){var v=2*h*Math.PI/r,l=Math.sin(v),d=Math.cos(v)*f,g=s,M=l*f,p=1-h/r,A=1-u/e;i.push(d,g,M),o.push(p,A),n.push(t*d,t*g,t*M)}for(u=0;u<e;++u)for(h=0;h<r;++h){var m=u*(r+1)+h,y=m+r+1;a.push(y,m,m+1,y+1,y,m+1)}return{vertices:n,textures:o,normals:i,indices:a}},t.Camera=A,t.glMatrix=u,t.mat4=v,t.quat=l,t.vec3=d,t.math=g,Object.defineProperty(t,"__esModule",{value:!0})});
